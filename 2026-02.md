# **2/7(土)**
### 【学習時間】
4.2h(累計:1205h/1,000h)  

### 【学習内容】
- paiza
- 本リリ作業
___
### 【やったこと】
- 日本酒記録のFormObject化
  - 日本酒の記録を投稿する場合、Sakeモデル・SakeLogモデルの2つのモデルの更新が必要である。(今後、さらに関連モデルが増える)
  - SakeLogControllerでCRUD処理を行っていたが、単一責任の原則に反するため、FormObjectを作成し、責任を分解した
- 編集・削除ボタンのサイズ変更(小さったので大きくした)
- 画面の見た目の微調整  
  
### 【学んだこと】（知識・タスク分解などの振り返り）  
- FormObject化について
	- FormObjectする前は、バリデーションチェック等は、ApplicationRecordを継承しているSakeLogモデル等が行っていた
	- 一方、FormObjectは、ApplicationRecord を継承しない Plain Ruby Object（PORO）の為、バリデーションのような機能を使いたい場合は、必要なモジュールをインクルードする　必要がある。
  - インクルードしたモデル
	  - Modelモジュール
		  - 属性への代入、属性の命名、バリデーション機能などが使用可能となる
		  - 上記の機能はModelモジュールに含まれるAPIモジュールが持っている機能である(ActiveModel::Modelをインクルードすれば、そこに含まれるActiveModel::APIの機能も使用できる)
		  - [Modelモジュール Railsガイド](https://railsguides.jp/v7.2/active_model_basics.html#model%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB)
	  - データ型の定義、デフォルト値の設定機能などが使用可能となる
	  - [Attributesモジュール Railsガイド](https://railsguides.jp/v7.2/active_model_basics.html#attributes%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB)
  - コンストラクタ
	  - SakeLogForm.newでコンストラクタが呼ばれる
- form_withについて
  - ビューでform_withを呼ぶと暗示的に以下が呼ばれる
    - persisted?メソッド
	    - 対象インスタンスがDBに保存済みか否かを返す
	    - 戻り値を受けてビュー側では以下の挙動となる
		    - 未保存なら、新規作成画面となる
		    - 保存済みなら、編集画面となる
	    - ActiveModel::APIモジュールでは、persisted?メソッドがデフォルトでは `false` を返すため、編集フォームを作る場合はオーバーライドする必要がある。[Active Model API](https://api.rubyonrails.org/v7.2.3/classes/ActiveModel/API.html#method-i-persisted-3F)
    - model_nameメソッド
      - form_objectはモデル名からURLを推察する。
      - 今回は、sake_logs_pathを使用したいので、 `SakeLog.model_name` を返している
    - to_modelメソッド
      - ActiveModel::APIモジュールのデフォルトでは、 `self` を返す。(今回はそのまま)
- **`assign_attributes` メソッド**
    - 指定した値をモデルの属性に値を代入するメソッド
    - データベースに保存するされないため、`save`メソッドが別途必要
    - 一部の属性だけを変更し、他の属性を保持したままにできる
- rubyのメソッドの引数を渡すときに `()` を省略できる
    - redirect_toなど、メソッドの後に色々オプションを記述するコードの書き方がありますが、これはrubyのコードは引数の`()` を省略できるというルールを使って記載している。つまり、redirect_toの後に続くものは、redirect_toへの引数である。
    - redirect_to
        
        ```ruby
        # 括弧なし（よく見る）
        redirect_to sake_logs_path, notice: "保存しました"
        
        # 括弧あり
        redirect_to(sake_logs_path, notice: "保存しました")
        ```
        
    - validates
        
        ```ruby
        # 括弧なし（よく見る）
        validates :rating, presence: true, numericality: { only_integer: true }
        
        # 括弧あり
        validates(:rating, presence: true, numericality: { only_integer: true })
        ```
        
    - アソシエーション
        
        ```ruby
        # 括弧なし（よく見る）
        belongs_to :user
        has_many :sake_logs, dependent: :destroy
        
        # 括弧あり
        belongs_to(:user)
        has_many(:sake_logs, dependent: :destroy)
        ```

___

FormObject化をしたことで、Railsが裏でよしなにやってくれていたことを自分で実装する必要があり、どんな処理をしているかを知ることが出来ました。
また、実務でJavaでオブジェクト指向の実装を行っており、色々クラス設計を行った経験があったため、FormObjectのような新たなクラスを作る際に、知識をキャッチアップしやすくなったなという実感がありました。

___
FormObjectを実装するにあたり、Railsの公式ドキュメントを様々読みました。
公式ドキュメントがあるのはありがたいなと思う一方、Javaの公式ドキュメント(Java API ドキュメント)の方がユーザー数が多いからか充実しているなと感じました。(標準化されていたり、リンクが充実していたり、、、)